# {{ ansible_managed }}

# Surveillance du service apache
check process apache with pidfile /var/run/apache.pid

# Gestion du daemon
start program  "/usr/bin/systemctl start httpd"
stop program  "/usr/bin/systemctl stop httpd"
restart program  "/usr/bin/systemctl restart httpd"

# Conditions de surveillance

if cpu is greater than 60% for 2 cycles then alert

if cpu > 80% for 5 cycles then restart

if totalmem > 500 MB for 5 cycles then restart

if children > 250 then restart

if loadavg(5min) greater than 10 for 8 cycles then stop

if 3 restarts within 5 cycles then timeout

# Ajout du soft dans un groupe
group webserver
